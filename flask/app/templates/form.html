{% extends "base.html" %}

    <style>
        {% block style %}
        body {
            padding: 20px;
        }
        .container {
            max-width: 800px;
        }
        .graph-container {
            margin-top: 20px;
        }
        .sortable {
            cursor: pointer;
        }
        .sort-icon {
            margin-left: 5px;
        }
        {% endblock %}
    </style>

{% block content %}
<head>
    <center><title>Result and visualization </title></center>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.2.1/cerulean/bootstrap.min.css">
</head>
<body>
<div class="container">
    <center><h2 class="mb-4">Result and visualization</h2></center>

    <a href="#graph-container" class="btn btn-primary mb-3">Go to Graph</a>

    <table id="gene-table" class="table table-hover">
        <thead class="thead-dark">
        <tr>
            <th scope="col">Gene</th>
            <th scope="col" class="sortable" onclick="sortTable('Enhancer')">Enhancers <i id="enhancer-sort-icon" class="sort-icon"></i></th>
            <th scope="col" class="sortable" onclick="sortTable('Silencer')">Silencers <i id="silencer-sort-icon" class="sort-icon"></i></th>
            <th scope="col" class="sortable" onclick="sortTable('Gene_Expression')">Gene_Expression <i id="Gene_Expression-sort-icon" class="sort-icon"></i></th>
        </tr>
        </thead>
        <tbody>
        {% for gene in genes %}
        <tr>
            <td>{{ gene.name }}</td>
            <td>{{ gene.enhancers }}</td>
            <td>{{ gene.silencers }}</td>
            <td>{{ gene.Gene_Expression}}</td>
        </tr>
        {% endfor %}
        <tr>
            <td>ENSG00000149451</td>
            <td>4</td>
            <td>9</td>
            <td>0.02</td> <!-- The value for Gene_Expression is missing in the provided data -->
        </tr>
        <tr>
            <td>ENSG00000129354</td>
            <td>5</td>
            <td>4</td>
            <td>0.28</td>
        </tr>
        <tr>
            <td>ENSG00000157470</td>
            <td>3</td>
            <td>1</td>
            <td>7.89</td>
        </tr>
        <tr>
            <td>ENSG00000138670</td>
            <td>2</td>
            <td>6</td>
            <td>0.06</td>
        </tr>
        <tr>
            <td>ENSG00000124181</td>
            <td>4</td>
            <td>3</td>
            <td>5.22</td>
        </tr>
        <tr>
            <td>ENSG00000115271</td>
            <td>2</td>
            <td>1</td>
            <td>10.39</td>
        </tr>
        <tr>
            <td>ENSG00000129493</td>
            <td>2</td>
            <td>2</td>
            <td>5.21</td>
        </tr>
        <tr>
            <td>ENSG00000139160</td>
            <td>3</td>
            <td>6</td>
            <td>0.22</td>
        </tr>
        <tr>
            <td>ENSG00000271949</td>
            <td>1</td>
            <td>1</td>
            <td>3.33</td>
        </tr>
        <tr>
            <td>ENSG00000151208</td>
            <td>4</td>
            <td>9</td>
            <td>0.04</td>
        </tr>
        <tr>
            <td>ENSG00000160613</td>
            <td>5</td>
            <td>3</td>
            <td>31.75</td>
        </tr>
        <tr>
            <td>ENSG00000137808</td>
            <td>1</td>
            <td>7</td>
            <td>0.00</td>
        </tr>
        <tr>
            <td>ENSG00000099957</td>
            <td>4</td>
            <td>6</td>
            <td>1.06</td>
        </tr>
        <tr>
            <td>ENSG00000070444</td>
            <td>1</td>
            <td>1</td>
            <td>6.19</td>
        </tr>
        <tr>
            <td>ENSG00000171984</td>
            <td>2</td>
            <td>3</td>
            <td>7.47</td>
        </tr>
        <tr>
            <td>ENSG00000171444</td>
            <td>3</td>
            <td>3</td>
            <td>0.15</td>
        </tr>
        <tr>
            <td>ENSG00000173226</td>
            <td>4</td>
            <td>3</td>
            <td>16,26</td>
        </tr>
        <tr>
            <td>ENSG00000152689</td>
            <td>3</td>
            <td>1</td>
            <td>24.03</td>
        </tr>
        <tr>
            <td>ENSG00000011405</td>
            <td>4</td>
            <td>4</td>
            <td>5.61</td>
        </tr>
        <tr>
            <td>ENSG00000186106</td>
            <td>1</td>
            <td>5</td>
            <td>0.45</td>
        </tr>
        <tr>
            <td>ENSG00000100416</td>
            <td>3</td>
            <td>1</td>
            <td>22.21</td>
        </tr>
        <tr>
            <td>ENSG00000186017</td>
            <td>1</td>
            <td>1</td>
            <td>2.28</td>
        </tr>
        <tr>
            <td>ENSG00000167306</td>
            <td>2</td>
            <td>4</td>
            <td>1.6</td>
        </tr>
        </tbody>
    </table>

    <div class="form-group">
        <label for="graph-type">Select Graph Type:</label>
        <select id="graph-type" class="form-control">
            {% for type in graph_types %}
            <option value="{{ type }}">{{ type }}</option>
            {% endfor %}
            <option value="point_plot">Point Plot</option>
            <option value="box_plot">Box Plot</option>
            <option value="heatmap">heatmap</option>
            <option value="hexbin scatter plot">hexbin scatter plot</option>
        </select>
    </div>

    <div id="graph-container" class="graph-container">
        <img id="graph" src="{{url_for('static', filename='graph.png')}}" alt="File Example">
    </div>
</div>
</body>
{% endblock %}
{% block script %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.1/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript">
    var enhancerSortOrder = 'asc';
    var silencerSortOrder = 'asc';

    function sortTable(column) {
        if (column === 'enhancer') {
            enhancerSortOrder = enhancerSortOrder === 'asc' ? 'desc' : 'asc';
            $('#enhancer-sort-icon').toggleClass('fa-sort-up fa-sort-down');
            $('#silencer-sort-icon').removeClass('fa-sort-up fa-sort-down');
        } else if (column === 'silencer') {
            silencerSortOrder = silencerSortOrder === 'asc' ? 'desc' : 'asc';
            $('#silencer-sort-icon').toggleClass('fa-sort-up fa-sort-down');
            $('#enhancer-sort-icon').removeClass('fa-sort-up fa-sort-down');
        }

        var rows = Array.from($('#gene-table tbody tr')).sort(function (a, b) {
            var valueA = parseInt($(a).find('td:nth-child(' + (column === 'enhancer' ? 2 : 3) + ')').text());
            var valueB = parseInt($(b).find('td:nth-child(' + (column === 'enhancer' ? 2 : 3) + ')').text());

            if (column === 'enhancer') {
                if (enhancerSortOrder === 'asc') {
                    return valueA - valueB;
                } else {
                    return valueB - valueA;
                }
            } else if (column === 'silencer') {
                if (silencerSortOrder === 'asc') {
                    return valueA - valueB;
                } else {
                    return valueB - valueA;
                }
            }
        });

        $('#gene-table tbody').empty().append(rows);
    }

    $(document).ready(function() {
        $('#graph-type').change(function() {
            var selectedGraph = $(this).val();
            var graphUrl = '/graph?type=' + selectedGraph;
            $('#graph-container img').attr('src', graphUrl);
        });
    });
</script>
{% endblock %}